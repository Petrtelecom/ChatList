# План реализации программы ChatList

Поэтапный порядок действий по реализации программы для сравнения ответов нейросетей.

---

## Этап 1: Подготовка проекта и окружения

### 1.1 Обновление зависимостей
- [ ] Добавить в `requirements.txt` необходимые библиотеки:
  - `requests` или `httpx` для HTTP-запросов
  - `python-dotenv` для работы с .env файлом
  - Обновить версию PyQt5 если необходимо

### 1.2 Создание структуры проекта
- [ ] Создать файл `.env.example` с примерами переменных окружения
- [ ] Создать файл `.gitignore` (если отсутствует) для исключения .env, .db файлов
- [ ] Создать директорию для модулей (опционально)

### 1.3 Создание конфигурационных файлов
- [ ] Создать файл `config.py` для общих настроек приложения

---

## Этап 2: Реализация работы с базой данных (db.py)

### 2.1 Базовые функции
- [ ] Создать модуль `db.py`
- [ ] Реализовать функцию `init_database()` для создания БД и таблиц
- [ ] Реализовать функцию `get_connection()` для получения соединения с БД
- [ ] Реализовать закрытие соединений

### 2.2 Работа с таблицей prompts
- [ ] `create_prompt(prompt_text, tags)` - создание нового промта
- [ ] `get_all_prompts()` - получение всех промтов
- [ ] `get_prompt_by_id(prompt_id)` - получение промта по ID
- [ ] `search_prompts(query)` - поиск промтов по тексту
- [ ] `update_prompt_tags(prompt_id, tags)` - обновление тегов
- [ ] `delete_prompt(prompt_id)` - удаление промта

### 2.3 Работа с таблицей models
- [ ] `get_all_models()` - получение всех моделей
- [ ] `get_active_models()` - получение только активных моделей
- [ ] `add_model(name, api_url, api_id, model_type)` - добавление новой модели
- [ ] `update_model_status(model_id, is_active)` - изменение статуса модели
- [ ] `delete_model(model_id)` - удаление модели (с проверкой связей)
- [ ] `search_models(query)` - поиск моделей по названию

### 2.4 Работа с таблицей results
- [ ] `save_result(prompt_id, model_id, response_text, tokens_used, response_time)` - сохранение результата
- [ ] `save_multiple_results(results_list)` - массовое сохранение результатов
- [ ] `get_results_by_prompt(prompt_id)` - получение всех результатов по промту
- [ ] `get_all_results()` - получение всех сохраненных результатов
- [ ] `search_results(query)` - поиск результатов по тексту ответа
- [ ] `delete_result(result_id)` - удаление результата
- [ ] `delete_results_by_prompt(prompt_id)` - удаление всех результатов по промту

### 2.5 Работа с таблицей settings
- [ ] `get_setting(key, default=None)` - получение настройки
- [ ] `set_setting(key, value)` - установка настройки
- [ ] `get_all_settings()` - получение всех настроек
- [ ] Инициализация настроек по умолчанию в `init_database()`

### 2.6 Тестирование модуля db.py
- [ ] Создать простой тестовый скрипт для проверки всех функций
- [ ] Убедиться, что БД создается корректно
- [ ] Проверить работу всех CRUD операций

---

## Этап 3: Реализация логики работы с моделями (models.py)

### 3.1 Создание модуля models.py
- [ ] Создать класс `Model` для представления модели нейросети
- [ ] Создать класс `ModelManager` для управления моделями

### 3.2 Работа с API-ключами
- [ ] Функция для загрузки переменных окружения из .env файла
- [ ] Функция `get_api_key(api_id)` - получение API-ключа по имени переменной
- [ ] Валидация наличия необходимых API-ключей

### 3.3 Работа со списком моделей
- [ ] Загрузка списка моделей из БД
- [ ] Фильтрация активных моделей
- [ ] Кэширование списка моделей в памяти

---

## Этап 4: Реализация сетевых запросов (network.py)

### 4.1 Базовые функции
- [ ] Создать модуль `network.py`
- [ ] Создать базовый класс или функции для работы с API

### 4.2 Реализация провайдеров для разных типов моделей
- [ ] `send_openai_request(api_key, model_name, prompt)` - запрос к OpenAI API
- [ ] `send_deepseek_request(api_key, prompt)` - запрос к DeepSeek API
- [ ] `send_groq_request(api_key, model_name, prompt)` - запрос к Groq API
- [ ] `send_anthropic_request(api_key, prompt)` - запрос к Anthropic API

### 4.3 Универсальная функция отправки
- [ ] `send_prompt_to_model(model, prompt)` - универсальная функция, определяющая тип модели и вызывающая соответствующий провайдер
- [ ] Обработка ошибок сети (таймауты, ошибки API, неверные ключи)
- [ ] Логирование запросов и ответов

### 4.4 Параллельная отправка запросов
- [ ] Реализовать отправку запросов в несколько моделей параллельно (threading или asyncio)
- [ ] Обработка частичных успехов (если одна модель не ответила)
- [ ] Измерение времени ответа для каждой модели

---

## Этап 5: Реализация GUI интерфейса (main.py)

### 5.1 Базовая структура окна
- [ ] Создать главное окно `MainWindow` на основе существующего шаблона
- [ ] Определить основные области интерфейса:
  - Область ввода/выбора промта
  - Область кнопок управления (отправить, сохранить, очистить)
  - Область отображения результатов (таблица)
  - Область сохраненных промтов (список)

### 5.2 Область работы с промтами
- [ ] Текстовое поле для ввода нового промта (QTextEdit)
- [ ] Выпадающий список или таблица для выбора сохраненных промтов
- [ ] Кнопка "Новый промт" для очистки формы
- [ ] Поле для ввода/редактирования тегов
- [ ] Кнопка "Сохранить промт" (сохраняет в БД)

### 5.3 Область управления запросами
- [ ] Кнопка "Отправить запрос" - запускает отправку во все активные модели
- [ ] Индикатор прогресса загрузки (QProgressBar)
- [ ] Кнопка "Отмена" для прерывания запросов
- [ ] Выбор активных моделей (чекбоксы или список с чекбоксами)

### 5.4 Таблица результатов
- [ ] Создать QTableWidget для отображения временной таблицы результатов
- [ ] Колонки: "Модель", "Ответ", "Выбрано" (чекбокс), "Время ответа"
- [ ] Настройка ширины колонок
- [ ] Возможность прокрутки длинных ответов
- [ ] Подсветка выбранных строк

### 5.5 Функционал сохранения
- [ ] Кнопка "Сохранить выбранные" - сохраняет отмеченные результаты в БД
- [ ] Кнопка "Очистить результаты" - очищает временную таблицу
- [ ] Автоматическая очистка при новом запросе

### 5.6 Дополнительные элементы интерфейса
- [ ] Меню "Файл" с опциями экспорта, выхода
- [ ] Меню "Настройки" для управления моделями и настройками приложения
- [ ] Меню "Справка" с информацией о программе

---

## Этап 6: Интеграция всех модулей

### 6.1 Связывание GUI с логикой
- [ ] Подключить db.py к main.py
- [ ] Подключить models.py к main.py
- [ ] Подключить network.py к main.py
- [ ] Реализовать обработчики событий для всех кнопок

### 6.2 Реализация основного рабочего процесса
- [ ] При нажатии "Отправить запрос":
  - Получить текст промта
  - Получить список активных моделей
  - Отправить запросы параллельно
  - Отобразить результаты в таблице
- [ ] При нажатии "Сохранить выбранные":
  - Сохранить промт в БД (если новый)
  - Сохранить отмеченные результаты в БД
  - Очистить временную таблицу

### 6.3 Обработка ошибок в GUI
- [ ] Отображение сообщений об ошибках через QMessageBox
- [ ] Обработка отсутствующих API-ключей
- [ ] Обработка ошибок сети
- [ ] Обработка ошибок БД

---

## Этап 7: Дополнительные функции

### 7.1 Поиск и сортировка
- [ ] Поиск в таблице промтов (фильтр по тексту)
- [ ] Поиск в таблице результатов (фильтр по модели, тексту ответа)
- [ ] Сортировка по дате, модели, длине ответа
- [ ] Поиск в сохраненных результатах

### 7.2 Управление моделями
- [ ] Диалог добавления новой модели
- [ ] Редактирование существующих моделей
- [ ] Активация/деактивация моделей
- [ ] Удаление моделей (с проверкой зависимостей)

### 7.3 Экспорт результатов
- [ ] Экспорт в Markdown формат
- [ ] Экспорт в JSON формат
- [ ] Выбор формата экспорта в настройках
- [ ] Диалог выбора файла для экспорта

### 7.4 Логирование
- [ ] Настройка логирования (модуль logging)
- [ ] Логирование всех запросов к API
- [ ] Логирование ошибок
- [ ] Сохранение логов в файл (опционально)

---

## Этап 8: Тестирование и отладка

### 8.1 Функциональное тестирование
- [ ] Тестирование создания и работы с БД
- [ ] Тестирование отправки запросов к разным API
- [ ] Тестирование сохранения результатов
- [ ] Тестирование поиска и фильтрации

### 8.2 Тестирование GUI
- [ ] Тестирование всех кнопок и элементов интерфейса
- [ ] Тестирование обработки ошибок
- [ ] Тестирование на разных разрешениях экрана

### 8.3 Исправление багов
- [ ] Исправление найденных ошибок
- [ ] Оптимизация производительности
- [ ] Улучшение обработки ошибок

---

## Этап 9: Финальная подготовка

### 9.1 Документация
- [ ] Обновить README.md с инструкциями по установке и использованию
- [ ] Добавить примеры использования
- [ ] Документировать формат .env файла

### 9.2 Упаковка приложения
- [ ] Проверить работу сборки через PyInstaller (build.ps1)
- [ ] Протестировать скомпилированный .exe файл
- [ ] Убедиться, что все зависимости включены

### 9.3 Оптимизация
- [ ] Проверить и оптимизировать запросы к БД
- [ ] Оптимизировать загрузку данных в GUI
- [ ] Проверить использование памяти

---

## Приоритет реализации

**Высокий приоритет (необходимо для базовой работы):**
- Этапы 1-6: Базовая функциональность

**Средний приоритет (важно для удобства использования):**
- Этап 7.1-7.2: Поиск, сортировка, управление моделями

**Низкий приоритет (можно добавить позже):**
- Этап 7.3-7.4: Экспорт, расширенное логирование

---

## Примечания

- Все модули должны быть независимыми и легко тестируемыми
- Использовать паттерн разделения ответственности (Separation of Concerns)
- Код должен быть читаемым и документированным
- При работе с БД использовать транзакции для обеспечения целостности данных

